import{_ as t,a,b as e,g as n,c as i,d as r,e as o,f as u,r as l,h as c,s as h,i as s,j as v,o as d,k as g,m as f,l as p,n as m,p as w,w as y,q as L,t as M,u as b,v as x,F as I,x as H,y as W,z as P}from"./vendors.6afb3552.js";var C=window.devicePixelRatio;console.log("dpr",C);var T=function(t){var a=t.ctx,e=t.width,n=t.height;a.canvas.width=e,a.canvas.height=n,a.fillStyle="white",a.fillRect(0,0,e,n)},k=function(t){return new Promise(function(a,e){try{var n=t.canvas.toDataURL("image/jpeg",1),i=document.createElement("a");i.download="\u5408\u56fe\u56fe-".concat((new Date).toLocaleString(),".jpg"),i.href=n,document.body.appendChild(i),i.click(),document.body.removeChild(i),a()}catch(r){e(r)}})};function R(t,a,e,n,i,r,o,u,l,c,h){t.save(),t.beginPath(),t.moveTo(e+o,n),t.lineTo(e+i-o,n),t.arc(e+i-o,n+o,o,1.5*Math.PI,2*Math.PI),t.lineTo(e+i,n+r-o),t.arc(e+i-o,n+r-o,o,0,.5*Math.PI),t.lineTo(e+o,n+r),t.arc(e+o,n+r-o,o,.5*Math.PI,Math.PI),t.lineTo(e,n+o),t.arc(e+o,n+o,o,Math.PI,1.5*Math.PI),t.closePath(),t.clip(),void 0!==u&&void 0!==l&&void 0!==c&&void 0!==h?t.drawImage(a,u,l,c,h,e,n,i,r):t.drawImage(a,e,n,i,r),t.restore()}function z(t){var a=t.ctx,e=t.width,n=t.height;t.canvas,T({ctx:a,width:e,height:n})}function _(t){var a=t.ctx;return t.canvasId,t.canvasWidth,t.canvasHeight,t.canvas,k(a)}function B(t){return F.apply(this,arguments)}function F(){return F=t(a().m(function t(e){var i;return a().w(function(t){while(1)switch(t.n){case 0:return t.a(2,new Promise(function(t,a){var n=new Image;n.onload=function(){return t({width:n.width,height:n.height})},n.onerror=a,n.src=e}));case 1:return t.n=2,n({src:e});case 2:return i=t.v,t.a(2,{width:i.width,height:i.height});case 3:return t.a(2)}},t)})),F.apply(this,arguments)}function S(t){return new Image}function D(t){return j.apply(this,arguments)}function j(){return j=t(a().m(function t(n){var i,r,o,u,l,c;return a().w(function(t){while(1)switch(t.n){case 0:i=n.ctx,r=n.imageLayout,o=n.imageInfos,n.canvas,u=[],l=a().m(function t(){var e,n,l,h,s,v,d,g,f,p,m,w,y;return a().w(function(t){while(1)switch(t.n){case 0:if(e=o[c]||{},e.url&&r[c]){t.n=1;break}return t.a(2,1);case 1:n=r[c],l=n.x,h=n.y,s=n.crop,v=n.width,d=n.height,g=s.x,f=s.y,p=s.cropWidth,m=s.cropHeight,w=s.round,y=new Promise(function(t){var a=S();a.src=e.url,a.width=e.width,a.height=e.height,a.onload=function(){R(i,a,l,h,v,d,w,g,f,p,m),t()},a.onerror=function(a){console.error("\u56fe\u7247\u52a0\u8f7d\u5931\u8d25:",e.src,a),t()}}),u.push(y);case 2:return t.a(2)}},t)}),c=0;case 1:if(!(c<o.length)){t.n=4;break}return t.d(e(l()),2);case 2:if(!t.v){t.n=3;break}return t.a(3,3);case 3:c++,t.n=1;break;case 4:return t.n=5,Promise.all(u);case 5:return t.a(2)}},t)})),j.apply(this,arguments)}function E(t){return new Promise(function(a){var e=document.querySelector('[canvas-id="'.concat(t,'"]')),n=e.getContext("2d");a({ctx:n,canvas:e})})}function q(t){var a=t.aspectRatio,e=t.width,n=t.height,i={width:0,height:0};if(a<=0)throw new Error("\u9ad8\u5bbd\u6bd4\u5fc5\u987b\u5927\u4e8e 0");return void 0!==e&&void 0===n?(i.width=Math.min(e,700),i.height=i.width*a):void 0!==n&&void 0===e?(i.height=n,i.width=i.height/a,i.width>700&&(i.width=700,i.height=i.width*a)):(i.width=700,i.height=i.width*a),i.width=Math.round(i.width),i.height=Math.round(i.height),i}function A(t){var a=t.totalWidth,e=t.totalHeight,n=t.layoutConfig,r=t.padding,o=t.gap,u=void 0===o?0:o,l=r||[u,u,u,u],c=i(l,4),h=c[0],s=c[1],v=c[2],d=c[3],g=Array.isArray(u)?u:[u,u],f=i(g,2),p=f[0],m=f[1],w=a-d-s,y=e-h-v,L=n.cols,M=n.rows,b=(L-1)*m,x=(M-1)*p,I=(w-b)/L,H=(y-x)/M,W=n.areas.map(function(t,a){var e=i(t,4),n=e[0],r=e[1],o=e[2],u=e[3],l=d+n*(I+m),c=h+r*(H+p),s=(o-n)*I+(o-n-1)*m,v=(u-r)*H+(u-r-1)*p;return{id:a,x:Math.round(l),y:Math.round(c),width:Math.round(s),height:Math.round(v),meta:{cellWidth:I,cellHeight:H,colGap:m,rowGap:p}}});return{totalWidth:a,totalHeight:e,id:n.id||"",grids:W,rowGap:p,colGap:m}}function G(t){var a=t.gridLayout,e=t.images,n=void 0===e?[]:e,i=t.round,r=a.grids.map(function(t,a){if(!n[a])return{};var e,r,o,u,l,c=n[a]||{width:1,height:1},h=c.height/c.width,s=t.height/t.width;return h>s?(e=t.width/c.width,o=t.height/e,r=c.width,o=Math.min(o,c.height),u=0,l=Math.max(0,(c.height-o)/2)):(e=t.height/c.height,r=t.width/e,o=c.height,r=Math.min(r,c.width),u=Math.max(0,(c.width-r)/2),l=0),(r>c.width||o>c.height)&&(e=Math.min(t.width/c.width,t.height/c.height),r=c.width,o=c.height,u=0,l=0,console.warn("\u56fe\u7247".concat(a,"\u5c3a\u5bf8\u4e0d\u8db3\uff0c\u5df2\u542f\u7528\u7f29\u653e\u586b\u5145\u6a21\u5f0f"))),{x:t.x,y:t.y,width:t.width,height:t.height,url:c.url,crop:{x:Math.round(u),y:Math.round(l),width:Math.round(c.width),height:Math.round(c.height),cropWidth:Math.round(r),cropHeight:Math.round(o),round:i},scale:parseFloat(e.toFixed(4))}});return r}function O(t){var a=t.images,e=a.filter(function(t){return!!t});if(!e||!e.length)return[{},{}];var n=[].concat(r(e),[{}]);return n.map(function(){return{}})}function Q(t){var a=t.images,e=t.gap,n=t.round,i=t.isHorizontal,r=t.canvasBaseH,o=t.canvasBaseW,u=a.filter(function(t){return!!t}),l=r/2,c=o;if(!u.length)return{layout:[]};var h={layout:[]};if(i){h.totalWidth=u.reduce(function(t,a){return t+Math.round(l/a.aspectRatio)},e),h.totalHeight=l;var s=e;u.forEach(function(t){var a=t.aspectRatio,i=Math.round(l/a-e),r=l-2*e;h.layout.push({x:s,y:e,w:i,h:r,width:i,height:r,crop:{round:n},round:n,url:t.url}),s+=i+e})}else{h.totalHeight=u.reduce(function(t,a){return t+Math.round(c*a.aspectRatio)},e),h.totalWidth=c;var v=e;u.forEach(function(t){var a=t.aspectRatio,i=c-2*e,r=Math.round(c*a-e);h.layout.push({x:e,y:v,w:i,h:r,width:i,height:r,crop:{round:n},round:n,url:t.url}),v+=r+e})}return h}function N(t){var a=t.layoutStore,e=t.longLayoutStore,n=a.isLongLayout;if(n){var i=e||{},r=i.longImageLayouCanvas,o=r||{},u=o.totalWidth,l=o.totalHeight,c=o.layout;return{imageLayout:c,totalWidth:u,totalHeight:l}}var h=a.imageLayoutCanvas,s=a.gridLayoutCanvas,v=s.totalWidth,d=s.totalHeight;return{imageLayout:h,totalWidth:v,totalHeight:d}}function U(){var t=navigator.userAgent.toLowerCase(),a=/android|iphone|symbianos|windows phone|ipad|ipod/i.test(t);return!a&&window.innerWidth>768}var $={LayoutDefinitions:{"grid-1":{name:"\u957f\u56fe",areas:[[[0,0,1,1],[1,0,2,1]],[[0,0,1,1],[0,1,1,2]]]},"grid-2":{name:"\u4e8c\u56fe",areas:[[[0,0,1,1],[1,0,2,1]],[[0,0,1,1],[0,1,1,2]],[[0,0,1.2,1],[1.2,0,2,1]],[[0,0,1,1.2],[0,1.2,1,2]],[[0,0,1,1],[1,1,2,2]],[[0,0,.8,1],[.8,0,2,1]],[[0,0,1,.8],[0,.8,1,2]],[[1,0,2,1],[0,1,1,2]]]},"grid-3":{name:"\u4e09\u56fe",areas:[[[0,0,1,1],[1,0,2,1],[2,0,3,1]],[[0,0,1,1],[0,1,1,2],[0,2,1,3]],[[0,0,1,1],[1,0,2,1],[0,1,2,2]],[[0,0,1,2],[1,0,2,1],[1,1,2,2]],[[0,0,1,1],[1,1,2,2],[2,0,3,1]],[[0,0,1,1],[1,0,2,2],[2,1,3,2]],[[0,0,2,1],[0,1,1,2],[1,1,2,2]],[[0,0,3,1],[0,1,1,2],[1,1,3,2]],[[0,0,2,1],[2,0,3,1],[0,1,3,2]],[[0,0,1,1],[0,1,1,2],[1,0,2,2]],[[0,0,2,2],[2,0,3,1],[2,1,3,2]],[[0,0,1,1],[0,1,1,2],[1,0,3,2]]]},"grid-4":{name:"\u56db\u56fe",areas:[[[0,0,1,1],[1,0,2,1],[0,1,1,2],[1,1,2,2]],[[0,0,3,1],[0,1,1,2],[1,1,2,2],[2,1,3,2]],[[0,0,2,1],[2,0,4,1],[0,1,1,2],[1,1,4,2]],[[0,0,1,1],[1,0,3,1],[3,0,4,1],[0,1,4,2]],[[0,0,2,1],[2,0,3,1],[3,0,4,1],[0,1,4,2]],[[0,0,1,1],[1,0,2,1],[2,0,3,1],[0,1,3,2]],[[0,0,1,1],[0,1,1,2],[0,2,1,3],[1,0,2,3]]]},"grid-5":{name:"\u4e94\u56fe",areas:[[[0,0,1,1],[1,0,2,1],[2,0,3,1],[0,1,2,2],[2,1,3,2]],[[0,0,1,2],[1,0,2,1],[1,1,2,2],[2,0,3,1],[2,1,3,2]],[[0,0,2,1],[2,0,3,1],[0,1,1,2],[1,1,3,2],[2,1,3,2]],[[0,0,2,1],[2,0,4,1],[0,1,2,2],[2,1,3,2],[3,1,4,2]],[[0,0,3,1],[3,0,4,1],[0,1,1,2],[1,1,4,2],[2,1,3,2]],[[0,0,1,1],[1,0,2,1],[2,0,3,1],[3,0,4,1],[0,1,4,2]],[[0,0,4,1],[4,0,5,1],[0,1,1,2],[1,1,2,2],[2,1,5,2]],[[0,0,1,1],[1,0,3,1],[3,0,4,1],[0,1,2,2],[2,1,4,2]],[[1,1,2,2],[0,0,1,1],[2,0,3,1],[0,2,1,3],[2,2,3,3]],[[0,0,1,1],[1,0,2,1],[0,1,1,2],[1,1,2,2],[0,2,2,3]],[[0,0,1,1],[1,0,2,1],[2,0,3,1],[0,1,1,2],[1,1,3,2]],[[0,0,1,2],[1,0,3,1],[1,1,2,2],[0,2,2,3],[2,1,3,3]],[[0,0,2,1],[2,0,3,2],[0,1,1,3],[1,1,2,2],[1,2,3,3]]]},"grid-6":{name:"\u516d\u56fe",areas:[[[0,0,1,1],[1,0,2,1],[2,0,3,1],[0,1,1,2],[1,1,2,2],[2,1,3,2]],[[0,0,1,1],[1,0,2,1],[0,1,1,2],[1,1,2,2],[0,2,1,3],[1,2,2,3]],[[0,0,1,1],[1,0,2,1],[2,0,3,1],[3,0,4,1],[0,1,2,2],[2,1,4,2]],[[0,0,1,1],[1,0,3,1],[3,0,4,1],[0,1,2,2],[2,1,3,2],[3,1,4,2]],[[0,0,3,1],[3,0,4,1],[0,1,1,2],[1,1,2,2],[2,1,3,2],[3,1,4,2]],[[0,0,2,1],[2,0,4,1],[0,1,1,2],[1,1,2,2],[2,1,3,2],[3,1,4,2]],[[0,0,1,1],[1,0,2,1],[2,0,3,1],[3,0,4,1],[4,0,5,1],[0,1,5,2]],[[0,0,2,1],[2,0,3,1],[3,0,5,1],[0,1,1,2],[1,1,4,2],[4,1,5,2]],[[0,0,1,1],[1,0,2,1],[0,1,1,2],[1,1,2,2],[2,0,3,2],[3,0,4,2]],[[0,0,2,1],[2,0,3,3],[0,1,1,4],[1,1,2,2],[1,2,2,3],[1,3,3,4]],[[0,0,1,2],[1,0,4,1],[1,1,2,2],[2,1,3,2],[0,2,3,3],[3,1,4,3]],[[0,0,1,1],[1,0,3,1],[0,1,2,2],[2,1,3,2],[0,2,1,3],[1,2,3,3]],[[0,0,2,1],[2,0,3,1],[0,1,1,2],[1,1,3,2],[0,2,2,3],[2,2,3,3]]]},"grid-7":{name:"\u4e03\u56fe",areas:[[[0,0,1,1],[1,0,2,1],[2,0,3,1],[0,1,1,2],[1,1,2,2],[2,1,3,2],[0,2,3,3]],[[0,0,3,1],[3,0,4,1],[0,1,1,2],[1,1,2,2],[2,1,3,2],[3,1,4,2],[0,2,4,3]],[[0,0,2,1],[2,0,3,1],[3,0,5,1],[0,1,1,2],[1,1,4,2],[4,1,5,2],[0,2,5,3]],[[1,1,2,2],[0,0,1,1],[2,0,3,1],[0,1,1,2],[2,1,3,2],[0,2,1,3],[2,2,3,3]],[[1,1,2,2],[0,0,1,1],[2,0,3,1],[0,2,1,3],[2,2,3,3],[1,0,2,1],[1,2,2,3]],[[0,0,3,1],[3,0,4,3],[0,1,1,4],[1,1,2,2],[2,1,3,2],[1,2,3,3],[1,3,4,4]],[[0,0,1,3],[1,0,4,1],[1,1,2,2],[2,1,3,2],[1,2,3,3],[0,3,3,4],[3,1,4,4]]]},"grid-8":{name:"\u516b\u56fe",areas:[[[0,0,1,1],[1,0,2,1],[2,0,3,1],[3,0,4,1],[0,1,1,2],[1,1,2,2],[2,1,3,2],[3,1,4,2]],[[0,0,1,1],[1,0,2,1],[2,0,3,1],[3,0,4,1],[4,0,5,1],[0,1,2,2],[2,1,4,2],[4,1,5,2]],[[0,0,2,1],[2,0,3,1],[3,0,5,1],[0,1,1,2],[1,1,4,2],[4,1,5,2],[0,2,5,3]],[[0,0,1,1],[1,0,2,1],[0,1,1,2],[1,1,2,2],[0,2,1,3],[1,2,2,3],[0,3,1,4],[1,3,2,4]],[[0,0,3,1],[3,0,4,3],[0,1,1,4],[1,1,2,2],[2,1,3,2],[1,2,2,3],[2,2,3,3],[1,3,4,4]],[[0,0,1,3],[1,0,4,1],[1,1,2,2],[2,1,3,2],[1,2,2,3],[2,2,3,3],[0,3,3,4],[3,1,4,4]]]},"grid-9":{name:"\u4e5d\u56fe",areas:[[[0,0,1,1],[1,0,2,1],[2,0,3,1],[0,1,1,2],[1,1,2,2],[2,1,3,2],[0,2,1,3],[1,2,2,3],[2,2,3,3]],[[0,0,1,1],[1,0,2,1],[2,0,3,1],[3,0,4,1],[0,1,1,2],[1,1,2,2],[2,1,3,2],[3,1,4,2],[0,2,4,3]],[[0,0,1,4],[1,0,4,1],[1,1,2,2],[2,1,3,2],[1,2,2,3],[2,2,3,3],[1,3,3,4],[0,4,3,5],[3,1,4,5]],[[0,0,3,1],[3,0,4,4],[0,1,1,5],[1,1,2,2],[2,1,3,2],[1,2,2,3],[2,2,3,3],[1,3,3,4],[1,4,4,5]]]},"grid-10":{name:"\u5341\u56fe",areas:[[[1,1,2,2],[0,0,1,1],[2,0,3,1],[0,1,1,2],[2,1,3,2],[0,2,1,3],[2,2,3,3],[1,0,2,1],[1,2,2,3],[0,3,3,4]],[[0,0,1,4],[1,0,4,1],[1,1,2,2],[2,1,3,2],[1,2,2,3],[2,2,3,3],[1,3,2,4],[2,3,3,4],[0,4,3,5],[3,1,4,5]],[[0,0,3,1],[3,0,4,4],[0,1,1,5],[1,1,2,2],[2,1,3,2],[1,2,2,3],[2,2,3,3],[1,3,2,4],[2,3,3,4],[1,4,4,5]]]}},getLayoutConfig:function(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=this.LayoutDefinitions[t],n=e.areas[a%e.areas.length],i=Math.max.apply(Math,r(n.map(function(t){return t[2]}))),u=Math.max.apply(Math,r(n.map(function(t){return t[3]})));return o(o({},e),{},{areas:n,cols:i,rows:u})},getAllLayoutConfigs:function(){var t=this,a={};return Object.keys(this.LayoutDefinitions).map(function(e){var n=t.LayoutDefinitions[e];a[e]=n.areas.map(function(t,a){var i=Math.max.apply(Math,r(t.map(function(t){return t[2]}))),u=Math.max.apply(Math,r(t.map(function(t){return t[3]})));return o(o({},n),{},{id:"".concat(e,"_").concat(a),areas:t,cols:i,rows:u})})}),a}},J=u("ratio",function(){var t=l([{label:"1:1",value:1},{label:"2:3",value:2/3},{label:"3:2",value:1.5},{label:"3:4",value:3/4},{label:"4:3",value:4/3},{label:"4:5",value:.8},{label:"5:4",value:5/4},{label:"5:6",value:5/6},{label:"6:5",value:1.2},{label:"6:7",value:6/7},{label:"7:6",value:7/6},{label:"8:9",value:8/9},{label:"9:8",value:9/8},{label:"10:11",value:10/11},{label:"11:10",value:1.1},{label:"12:13",value:12/13},{label:"13:12",value:13/12},{label:"14:15",value:14/15},{label:"15:14",value:15/14},{label:"16:17",value:16/17},{label:"17:16",value:17/16},{label:"16:9",value:16/9},{label:"9:16",value:9/16}]),a=l(1),e=function(t){a.value=t};return{customRatios:t,currentRatio:a,handleRatioSelected:e}}),K=u("layout",function(){var e=700,n=700,i=l([]),o=l({}),u=l([]),d=l(15),g=l(20),f=l(2),p=J();function m(t){f.value=t,console.log("\u8d28\u91cf\u503c:",t)}var w=c(function(){var t=p.currentRatio,a=Math.round(t*e),n=q({aspectRatio:t,height:a}),i=n.height;return i}),y=c(function(){var t=p.currentRatio,a=Math.round(n/t),e=q({aspectRatio:t,width:a}),i=e.width;return i}),L=c(function(){var t=!i.value.length||!i.value.some(function(t){return!!t});return t}),M=c(function(){var t=o.value.id;if(!t)return null;var a=$.getLayoutConfig.apply($,r(t.split("_")));return a}),b=c(function(){var t=o.value.id;return!!t&&"grid-1"===t.split("_")[0]}),x=c(function(){var t={},a=$.getAllLayoutConfigs();return Object.keys(a).map(function(e){t[e]={name:"",datas:[]},t[e].datas=a[e].map(function(a){return t[e].name=a.name,A({totalWidth:50,totalHeight:50,layoutConfig:a,gap:4})})}),console.log("\u6240\u6709\u5e03\u5c40:",t),t}),I=c(function(){if(!M.value)return null;var t=A({totalWidth:y.value,totalHeight:w.value,layoutConfig:M.value,gap:d.value});return console.log("\u5e03\u5c40\u914d\u7f6e\u4fe1\u606f:",M.value),console.log("\u7f51\u683c\u5e03\u5c40:",t),t}),H=c(function(){if(!u.value||!u.value.length)return{};var t=G({gridLayout:I.value,images:u.value,round:g.value});return console.log("\u56fe\u7247\u5e03\u5c40:",t),t}),W=c(function(){if(!M.value)return null;var t=A({totalWidth:Math.round(y.value*f.value),totalHeight:Math.round(w.value*f.value),layoutConfig:M.value,gap:Math.round(d.value*f.value)});return console.log("\u7f51\u683c\u5e03\u5c40canvas:",t),t}),P=c(function(){if(!u.value||!u.value.length)return{};var t=G({gridLayout:W.value,images:u.value,round:Math.round(g.value*f.value)});return console.log("\u56fe\u7247\u5e03\u5c40canvas:",t),t}),C=c(function(){if(!M.value||b.value)return 1;var t=M.value,a=t.areas,e=t.cols,n=Object.keys(u.value).reduce(function(t,a){return t+u.value[a].width},0);if(!n)return 1;var i=Math.round(n/a.length),r=Math.max(i*e/y.value,1);return console.log("\u8ba1\u7b97\u7cfb\u6570:",r.toFixed(1)),Number(r.toFixed(1))});function T(){return k.apply(this,arguments)}function k(){return k=t(a().m(function e(){return a().w(function(e){while(1)switch(e.n){case 0:return e.n=1,Promise.all(i.value.map(function(){var e=t(a().m(function t(e){var n;return a().w(function(t){while(1)switch(t.n){case 0:if(e){t.n=1;break}return t.a(2,"");case 1:return t.n=2,B(e);case 2:return n=t.v,t.a(2,{url:e,width:n.width,height:n.height,aspectRatio:n.height/n.width})}},t)}));return function(t){return e.apply(this,arguments)}}()));case 1:return e.a(2,e.v)}},e)})),k.apply(this,arguments)}function R(t){o.value=t,F()}var z=function(t){if(b.value)return i.value=i.value.filter(function(a,e){return e!==t}),void(u.value=u.value.filter(function(a,e){return e!==t}));i.value.splice(t,1,""),u.value.splice(t,1,"")},_=function(){var e=t(a().m(function t(e){var n,o,l,c,h;return a().w(function(t){while(1)switch(t.p=t.n){case 0:return t.p=0,n=I.value.grids.length||1,o=i.value.filter(function(t){return!!t}).length||0,l=b.value?100:n-o||1,t.n=1,v({count:l,sizeType:["original","compressed"],sourceType:["album","camera"]});case 1:if(c=t.v,1===c.tempFilePaths.length){while(i.value.length<=e)i.value.push("");i.value.splice(e,1,c.tempFilePaths[0])}return c.tempFilePaths.length>1&&(c.tempFilePaths=c.tempFilePaths.slice(0,l),(h=i.value).splice.apply(h,[e,l].concat(r(c.tempFilePaths)))),t.n=2,T();case 2:u.value=t.v,console.log("\u56fe\u7247\u4fe1\u606f",u.value),t.n=4;break;case 3:t.p=3,t.v,s({title:"\u9009\u62e9\u56fe\u7247\u5931\u8d25\uff01",icon:"none",duration:2e3});case 4:return t.a(2)}},t,null,[[0,3]])}));return function(t){return e.apply(this,arguments)}}();function F(){if(!b.value){var t=I.value.grids.length||1,a=i.value.filter(function(t){return!!t}).length||0;a<=t||(i.value=i.value.slice(0,t),u.value=u.value.slice(0,t))}}var S=c(function(){var t=[];return[{label:"del",action:function(){h({title:"\u63d0\u793a",content:"\u786e\u8ba4\u6e05\u7a7a\u6240\u6709\u56fe\u7247\u5417\uff1f",success:function(t){t.confirm&&(i.value=[],u.value=[])}})},disabled:L.value}].concat(r(t))});return{gridLayout:I,imageData:i,imageLayout:H,allLayout:x,currentTpl:o,onTpl:R,removeImage:z,addImage:_,imageInfos:u,isEmptyImage:L,gap:d,round:g,quality:f,setQuality:m,gridLayoutCanvas:W,imageLayoutCanvas:P,factor:C,isLongLayout:b,canvasBaseH:n,canvasBaseW:e,fastButton:S}}),V=u("longLayout",function(){var t=K(),a=t.canvasBaseH,e=t.canvasBaseW,n=c(function(){return!!t.currentTpl.id.match("0")}),i=c(function(){if(!t.imageInfos||!t.imageInfos.length)return null;var i=Q({images:t.imageInfos,round:t.round,isHorizontal:n.value,canvasBaseH:a,canvasBaseW:e,gap:t.gap});return console.log("\u957f\u56fe\u7247\u5e03\u5c40:",i),i}),r=c(function(){if(!t.imageInfos||!t.imageInfos.length)return null;var i=t.quality,r=Q({images:t.imageInfos,round:t.round*i,isHorizontal:n.value,canvasBaseH:a*i*2,canvasBaseW:e*i,gap:t.gap*i});return console.log("\u957f\u56fe\u7247\u5e03\u5c40canvas:",r),r}),o=c(function(){var a=O({images:t.imageInfos});return console.log("\u6a2a\u7ad6\u56fe\u7f51\u683c\u5e03\u5c40:",a),a});return{longImageLayout:i,longGridLayout:o,isHorizontal:n,longImageLayouCanvas:r}}),X=1280,Y=function(){var t=l(window.innerWidth),a=l(t.value>=X),e=l(t.value>=X),n=function(){t.value=window.innerWidth;var n=t.value>=X;a.value=n,e.value=n};return d(function(){window.addEventListener("resize",n),n()}),g(function(){window.removeEventListener("resize",n)}),{showTemplateDrawer:a,showSettings:e}},Z=u("puzzle",function(){var e=l(!1),n=Y(),i=n.showTemplateDrawer,r=n.showSettings,o=K(),u=V(),h=function(){var n=t(a().m(function t(){var n,i,r,o,u;return a().w(function(t){while(1)switch(t.p=t.n){case 0:return e.value=!0,t.p=1,n="puzzleCanvas",t.n=2,E(n);case 2:return i=t.v,r=i.ctx,o=i.canvas,t.n=3,v({ctx:r,canvasId:n,canvas:o});case 3:t.n=5;break;case 4:t.p=4,u=t.v,console.error(u),d("\u751f\u6210\u62fc\u56fe\u5931\u8d25"),e.value=!1;case 5:return t.a(2)}},t,null,[[1,4]])}));return function(){return n.apply(this,arguments)}}(),v=function(){var n=t(a().m(function t(n){var i,r,l,c,h,v,g,f;return a().w(function(t){while(1)switch(t.n){case 0:i=n.ctx,r=n.canvasId,l=n.canvas,c=o.imageInfos,h=N({layoutStore:o,longLayoutStore:u}),v=h.totalWidth,g=h.totalHeight,f=h.imageLayout,t.n=1;break;case 1:t.n=2;break;case 2:return t.n=3,z({ctx:i,width:v,height:g,canvas:l});case 3:return t.n=4,D({ctx:i,imageLayout:f,imageInfos:c,canvas:l});case 4:return t.a(2,_({ctx:i,canvasId:r,canvasWidth:v,canvasHeight:g,canvas:l}).then(function(){s({title:"\u4fdd\u5b58\u6210\u529f",icon:"success"})}).catch(function(t){console.error("\u4fdd\u5b58\u56fe\u7247\u5931\u8d25:",t),d("\u751f\u6210\u56fe\u7247\u5931\u8d25")}).finally(function(){e.value=!1}))}},t)}));return function(t){return n.apply(this,arguments)}}(),d=function(t){s({title:t,icon:"none",duration:3e3})};function g(t){var a=o.setQuality,e=o.isLongLayout;a(t.id),h(e)}var f=c(function(){var t=o.factor;return[{id:Math.min(t,C+1),name:"\u539f\u56fe\u751f\u6210"},{id:Math.min(t,C+1)+1,name:"\u9ad8\u6e05\u56fe\u751f\u6210"}]});return{isLoading:e,generatePuzzle:h,showTemplateDrawer:i,showSettings:r,chooseQuality:g,qualityItems:f}});const tt=(t,a)=>{const e=t.__vccOpts||t;for(const[n,i]of a)e[n]=i;return e};var at={__name:"layoutItem",props:f(["gridLayout","onTpl","currentTpl","addImage"],{gridLayout:function(){return{}},currentTpl:function(){return{}}}),setup:function(t){function a(a){return t.onTpl?{left:a.x+"px",top:a.y+"px",width:a.width+"px",height:a.height+"px"}:{left:"".concat(P(a.x)),top:"".concat(P(a.y)),width:"".concat(P(a.width)),height:"".concat(P(a.height))}}function e(){return t.onTpl?{width:t.gridLayout.totalWidth+"px",height:t.gridLayout.totalHeight+"px"}:{width:"".concat(P(t.gridLayout.totalWidth)),height:"".concat(P(t.gridLayout.totalHeight))}}return function(n,i){var r=p("taro-view");return m(),w(r,{class:"htt-container"},{default:y(function(){return[L(r,{class:M({"grid-container--active":t.currentTpl.id===t.gridLayout.id,"grid-container":!0}),style:b(e()),onClick:i[0]||(i[0]=function(a){return t.onTpl&&t.onTpl(t.gridLayout)})},{default:y(function(){return[(m(!0),x(I,null,H(t.gridLayout.grids,function(e,i){return m(),w(r,{key:e.id,class:"grid-item",style:b(a(e)),onClick:function(a){return t.addImage&&t.addImage(i)}},{default:y(function(){return[W(n.$slots,"image",{index:i})]}),_:2},1032,["style","onClick"])}),128))]}),_:3},8,["class","style"])]}),_:3})}}};const et=tt(at,[["__file","layoutItem.vue"]]);export{et as L,tt as _,Z as a,V as b,$ as c,J as d,U as i,K as u};
